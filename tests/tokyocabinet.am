# vim:ft=automake
# Gearman server and library
# Copyright (C) 2011 Data Differential, http://datadifferential.com/
# All rights reserved.
#
# Use and distribution licensed under the BSD license.  See
# the COPYING file in the parent directory for full text.
#
# Included from Top Level Makefile.am
# All paths should be given relative to the root
#

test-tokyocabinet: test-tokyocabinet-args test-tokyocabinet-queue

if HAVE_LIBTOKYOCABINET
TOKYOCABINET_TEST= tests/tokyocabinet_test
TOKYOCABINET_RM= @rm -f tests/gearman.tcb
CLEANFILES+= tests/gearman.tcb
noinst_PROGRAMS += tests/tokyocabinet_test
endif

tests_tokyocabinet_test_SOURCES= tests/tokyocabinet_test.cc
tests_tokyocabinet_test_LDADD= ${CLIENT_LDADD}

test-tokyocabinet-args: gearmand/gearmand
if HAVE_LIBTOKYOCABINET
	@gearmand/gearmand --check-args --libtokyocabinet-file=tmp/file --libtokyocabinet-optimize
endif

test-tokyocabinet-queue:
if HAVE_LIBTOKYOCABINET
	$(TOKYOCABINET_TEST) $(ARG1) $(ARG2)
	$(TOKYOCABINET_RM)
endif

valgrind-tokyocabinet:
if HAVE_LIBTOKYOCABINET
	$(VALGRIND_COMMAND) $(TOKYOCABINET_TEST) $(ARG1) $(ARG2)
	$(TOKYOCABINET_RM)
endif
